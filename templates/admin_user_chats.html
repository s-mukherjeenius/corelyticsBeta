<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat History - {{ user.full_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { 
            background-color: #f0f4f8; /* Brand Base Color */
            font-family: 'Inter', sans-serif; 
        }

        /* --- BRANDED HEADER --- */
        .admin-header {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white; padding: 1.25rem 2rem;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.2);
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 2rem;
        }

        .chat-wrapper {
            max-width: 900px; margin: 0 auto 4rem;
        }

        /* --- CONVERSATION CARDS --- */
        .conversation-card {
            background: white; 
            border-radius: 1rem; 
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); 
            border: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
            transition: box-shadow 0.2s;
        }
        .conversation-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); 
        }

        .conv-header {
            background-color: #ffffff; 
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #f1f5f9; 
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            transition: background-color 0.2s;
        }
        .conv-header:hover { background-color: #f8fafc; }
        
        .conv-title { 
            font-weight: 600; color: #1e293b; font-size: 1.05rem;
        }
        .conv-date { 
            font-size: 0.8rem; color: #94a3b8; margin-top: 4px; font-weight: 500;
        }
        
        .message-list {
            padding: 2rem; background-color: #fcfcfc; display: none; /* Hidden by default */
            border-top: 1px solid #e2e8f0;
        }
        .message-list.show { display: block; }
        
        .msg-row { display: flex; margin-bottom: 1.25rem; width: 100%; }
        .msg-row.user { justify-content: flex-end; }
        .msg-row.model { justify-content: flex-start; }
        
        /* --- BRANDED BUBBLES --- */
        .msg-bubble {
            max-width: 80%; 
            padding: 0.85rem 1.25rem; 
            border-radius: 1.25rem; 
            font-size: 0.95rem; 
            line-height: 1.6;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* User Bubble: Brand Gradient */
        .msg-row.user .msg-bubble {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white; 
            border-bottom-right-radius: 0.25rem;
        }
        
        /* AI Bubble: Gray/Slate */
        .msg-row.model .msg-bubble {
            background: #f1f5f9; 
            color: #334155; 
            border: 1px solid #e2e8f0; 
            border-bottom-left-radius: 0.25rem;
        }

        .role-label { 
            font-size: 0.65rem; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            margin-bottom: 4px; 
            display: block; 
            opacity: 0.8; 
            font-weight: 700;
        }

        /* Back Button Styling */
        .btn-back {
            color: white; text-decoration: none; 
            font-weight: 600; display: inline-flex; align-items: center;
            background: rgba(255,255,255,0.2);
            padding: 0.4rem 1rem; border-radius: 0.5rem;
            transition: background 0.2s;
        }
        .btn-back:hover { background: rgba(255,255,255,0.3); color: white; }

    </style>
</head>
<body>

    <div class="admin-header">
        <div>
            <a href="{{ url_for('admin.admin_dashboard') }}" class="btn-back me-3">
                <i class="fas fa-arrow-left me-2"></i> Back
            </a>
            <span class="fw-bold text-lg">Chat Logs: {{ user.full_name }}</span>
        </div>
        <div class="text-indigo-200 small bg-indigo-800 px-3 py-1 rounded-pill">ID: #{{ user.id }}</div>
    </div>

    <div class="container chat-wrapper">
        {% if conversations %}
            {% for conv in conversations %}
            <div class="conversation-card">
                <div class="conv-header" onclick="toggleChat('chat-{{ conv.id }}')">
                    <div class="d-flex align-items-center">
                        <div class="bg-indigo-100 text-indigo-600 rounded-circle p-2 me-3 d-flex justify-content-center align-items-center" style="width: 40px; height: 40px;">
                            <i class="far fa-comments"></i>
                        </div>
                        <div>
                            <div class="conv-title">{{ conv.title }}</div>
                            <div class="conv-date"><i class="far fa-clock me-1"></i> Started: {{ conv.created_at.strftime('%b %d, %Y at %H:%M') }}</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transition-transform" id="icon-chat-{{ conv.id }}"></i>
                </div>

                <div id="chat-{{ conv.id }}" class="message-list">
                    {% if conv.messages %}
                        {% for msg in conv.messages %}
                            <div class="msg-row {{ msg.role }}">
                                <div class="msg-bubble">
                                    <span class="role-label">{{ msg.role | replace('model', 'LOGIC AI') | upper }}</span>
                                    {{ msg.message }}
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center text-muted py-3">No messages found in this conversation.</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-5">
                <div class="mb-4 bg-white p-4 rounded-circle shadow-sm d-inline-block border">
                    <i class="far fa-comment-dots fa-3x text-gray-300"></i>
                </div>
                <h5 class="text-gray-600 fw-bold">No conversation history found</h5>
                <p class="text-gray-400">This user has not started any chats yet.</p>
            </div>
        {% endif %}
    </div>

    <script>
        function toggleChat(id) {
            const el = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);
            
            if (el.style.display === 'block') {
                el.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            } else {
                el.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            }
        }
    </script>
</body>
</html>